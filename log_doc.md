# Compliance Logs Documentation

This document describes the format and contents of compliance verification logs generated by the PTV (Process Tree Verifier) subscriber service.

## Log Generation Overview

When `subscriber.py` processes a verification request, it generates detailed logs that capture:
1. Process verification steps and outcomes
2. Activity detection and validation
3. Requirement verification results
4. Assurance level tracking
5. Error and warning messages


## Log Attributes and Metadata

### XES Log Attributes

When transformed to XES format, logs include:

```yaml
event:
  concept:instance: R0          # Requirement ID or "preprocessing", can be used as an activity notion
  concept:name: function_name   # Method/Function that send the log message, can be used as an activity notion
  id:id: module_name           # Module that send the log message, can be used as an activity notion
  ptv:call_uuid: unique_id     # Unique call identifier
  ptv:activity_uuid: computed_hash  # Activity hash
  cpee:instance: instance_uuid  # CPEE instance ID
  lifecycle:transition: start|complete|unknown  # Lifecycle transition as defined by the XES standard
  data: message_content        # The unprocessed compliance log entry as described below
  time:timestamp: iso_timestamp # Full timestamp
```

### Instance Tracking

- **concept:instance**: Requirement ID, to mine the process of verifying a specific requirement
- **cpee:instance**: Unique identifier for CPEE instance, to mine the process of modeling a compliant process
- **ptv:activity_uuid**: Hash of instance+pattern+module
- **ptv:call_uuid**: Unique identifier per call to the endpoint, to mine the process of verifying a single process

## Unprocessed Log Format

### Basic Structure

Each log entry follows this format:

```
TIMESTAMP.MSECS - MODULE_NAME - FUNCTION_NAME - MESSAGE
```

**Components:**
- `TIMESTAMP`: ISO format timestamp (e.g., `2026-02-24 14:32:15`)
- `MSECS`: Milliseconds with 3 decimal places (e.g., `.123`)
- `MODULE_NAME`: Python module/logger name (e.g., `annotated_verification`, `verificationAST`)
- `FUNCTION_NAME`: Name of the function generating the log
- `MESSAGE`: Detailed log message

### Example Log Entry

```
2026-02-24 14:32:15.145 - annotated_verification - exists - Activity "Evaluate Loan Risk" existence was checked but not found
```

## Log Levels

Logs are generated at different levels:

### INFO Level (Informational)
- Activity existence checks
- Successful verification conditions
- Control flow relationships found
- Resource assignments confirmed
- Data flow detected

**Example:**
```
2026-02-24 14:32:15.234 - annotated_verification - directly_follows - Activity "B" directly follows Activity "A" is True
```

### WARNING Level (Warnings)
- Non-standard implementations
- Missing annotations (resources, due dates, data objects)
- Dynamic data requirements
- Assumptions made during verification

**Effect:** Each warning reduces the assurance level by 10 points.

**Example:**
```
2026-02-24 14:32:18.567 - annotated_verification - timed_alternative - timeout in the parallel uses a dataobject timestamp or is not passed a digit, correct dataobject is assumed
```

## Content Organization

### 1. Preprocessing Phase

Occurs before requirement verification begins.

```
2026-02-24 14:32:14.001 - subscriber - Subscriber - No requirements attribute was passed, nothing to check
```

**Actions:**
- Log handler initialization
- XML parsing
- Subprocess combining
- Initial assurance level status

### 2. Requirement Verification Phase

Processes each requirement in sequence.

```
2026-02-24 14:32:15.100 - subscriber - Subscriber - Verifying Requirement R0: precedence('activity_a', 'activity_b')
2026-02-24 14:32:15.234 - annotated_verification - exists - Activity "activity_a" existence was checked and found
2026-02-24 14:32:15.267 - annotated_verification - precedence - Activity "activity_b" was found before "activity_a"
2026-02-24 14:32:15.301 - subscriber - Subscriber - Requirement R0 is True with assurance level 100
```

**Structure:**
1. Requirement identification and content
2. Individual verification steps for each method call
3. Final verdict with assurance level

### 3. Activity Tracking Phase

Records all activities found and missing from the process.

```
2026-02-24 14:32:18.456 - subscriber - Subscriber - Currently required activities for the process are: {'Validate Input', 'Process Payment', 'Send Confirmation'}
2026-02-24 14:32:18.489 - subscriber - Subscriber - Currently missing activities for the process are: {'Audit Log', 'Generate Report'}
```

### 4. Completion Phase

Final state after all requirements processed.

```
2026-02-24 14:32:19.001 - subscriber - Subscriber - Status: 200
2026-02-24 14:32:19.012 - subscriber - Subscriber - Response: OK
```

## Key Message Types

### Activity-Related Messages

**Activity Found:**
```
Found Activity "{label}" which sends dataobject "{data}"
```

**Activity Missing:**
```
Activity "{a}" is missing in the process
```

### Control Flow Messages

**Precedence Check:**
```
Activity "{b}" was found before "{a}", so precedence "{a}" requires "{b}" before is True
```

**Leads To Check:**
```
Activity "{a}" is before Activity "{b}"
```

**Loop Detection:**
```
Found Activity "{a}" in a loop {loop}
```

### Resource Messages

**Resource Assignment:**
```
Activity "{a}" is executed by Resource "{resource}"
```

**Resource Not Found:**
```
No Activity was found where resource "{resource}" is annotated as Resource
```

### Time-Related Messages

**Timing Constraints:**
```
Identified a timeout in a parallel cancel with "{b}"
timeout: "{timeout}", while time required is: "{time}"
```

**Recurring Pattern:**
```
Verified existence of "{a} in {loop}
```

### Data Flow Messages

**Data Sending:**
```
data object "{data}" is sent in the arguments of activity "{a}"
```

**Data Reception:**
```
data object "{data}" is finalized from Activity "{a}"
```

### Condition Messages

**Condition Found:**
```
Found a branch with condition: "{condition}" that eventually leads to "{a}"
```

**Condition Not Found:**
```
No branch with condition: "{condition}" was found
```

### Failure Handling Messages

**Failure Recovery:**
```
Found a dataobject "{data_object}" that is used in a rescue of "{a}", checking if there is a branch with condition that eventually leads to "{b}"
```

## Assurance Level Tracking

### Assurance Level States

The assurance level indicates confidence in verification results:

| Level | Meaning |
|-------|---------|
| 100 | Complete confidence - all checks passed with standard implementation |
| 90-99 | High confidence - minor warnings or assumptions |
| 70-89 | Medium confidence - missing annotations or non-standard patterns |
| 50-69 | Low confidence - significant issues or workarounds needed |
| <50 | Very low confidence - many unverified assumptions |

### Assurance Level Changes

Assurance level decreases when:
- Missing annotations are assumed
- Dynamic data requirements detected
- Non-standard implementations
- Compensations or workarounds needed

**Per Requirement:**
```
Requirement R0 is True with assurance level 95
```

**Global:**
```
The global assurance level is 100
```



